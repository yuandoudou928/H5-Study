### MySQL 数据库

#### 数据库的概念

数据库：database（DB），是一种存储数据的仓库。具有如下特性：

- 数据库是根据数据结构组织、存储和管理数据
- 数据库能够长期、高效的管理和存储数据
- 数据库的目的就是能够存储（写）和提供（读）数据

#### 数据库的分类

- 关系型数据库

  把复杂的数据结构归结为简单的二元关系，即二维表格形式（二维表）。注重数据存储的持久性

- 非关系型数据库

  没有具体模型的数据结构。英文简称 NoSQL（Not Only SQL），意为“不仅仅是SQL”。注重数据读取的效率

#### 关系型数据库

关系型数据库有四层结构：

- 数据库管理系统（DataBase Management System - DBMS）
- 数据库（DB）：数据存储的管理者
- 数据表（Table）：数据关系管理者
- 数据字段（Field）：实际数据存储者

##### 常见的关系型数据库

- 大型：Oracle
- 中型：MySQL、SQL Server
- 小型：Sybase、Access

#### 非关系型数据库

##### 常见的非关系型数据库

- MongoDB
- Redis
- Memcached

#### SQL 的介绍

SQL，全称 Structured Query Language ，译为 **结构化查询语言**

SQL 是一种针对关系型数据库的标准化编程语言，能够实现用户对数据库的查询和程序设计

通俗来讲，**SQL 是关系型数据库的操作指令**

根据操作类型不同，SQL 可分为：

- DQL（Data Query Language）：数据查询语言，用于查询和检索数据（查）
- DML（Data Manipulation Language）：数据操作语言，用于数据的写操作（增、删、改）
- DDL（Data Definition Language）：数据定义语言，用于创建数据结构
- DCL（Data Control Language）：数据控制语言，用于用户权限管理
- TPL（Transaction Process Language）：事务处理语言，辅助 DML 进行事务操作，因此也归属于 DML

SQL 虽然是编程语言，但通常只用来进行数据管理，逻辑部分交给其它编程语言

SQL 是针对关系型数据库的通用语言，所有关系型数据库都是基于 SQL 进行数据操作，而不同的数据库产品，在 SQL 操作指令上略有差异

#### MySQL 的介绍

##### MySQL 数据库的介绍

MySQL 是很有名的 关系型数据库产品，由瑞典MySQL AB 公司开发，现在属于 Oracle 旗下产品

MySQL 在 2008 年被 Sun 公司以10亿美金所收购，而 Sun 公司在2009年被 Oracle 甲骨文公司收购

MySQL 开源免费

##### MySQL 的访问原理

MySQL 是一种 C/S 结构的软件，因此我们需要安装 MySQL 的客户端来访问远程的服务端。也就是说，数据是存放在服务器上的，客户端通过执行 sql 指令来操作服务端的数据

具体步骤：

1. 客户端输入：主机（host） + 端口号（port）
2. 输入 username 和 password 验证身份
3. 客户端和服务端连接成功，通过 sql 指令开始操作数据库

#### MySQL 的安装

参考：https://juejin.im/post/6844903831298375693

1. [下载](https://dev.mysql.com/downloads/mysql/)安装包并安装

   - root 密码：Yx147258

2. 配置环境变量

   打开 `~/.bash_profile` 文件，在文件末尾添加如下内容：

   ```
   # mysql
   export PATH=${PATH}:/usr/local/mysql/bin
   # 快速启动、结束MySQL服务, 可以使用 alias 命令
   alias mysqlstart='sudo /usr/local/mysql/support-files/mysql.server start'
   alias mysqlstop='sudo /usr/local/mysql/support-files/mysql.server stop'
   ```

   配置好环境变量后，在终端输入 `source ~/.bash_profile` 命令，让配置生效

   在终端的任何位置，输入如下命令，即可进入 mysql 命令的执行窗口：

   ```
   mysql -u root -p
   ```

3. 配置启动环境变量

   在 `~/.bash_profile` 中配置好环境变量后，发现每次重启终端后，配置都会失效，需要重新执行 `source ~/.bash_profile` 命令

   原因是，zsh加载的是 `~/.zshrc`文件，而 `.zshrc` 文件中并没有定义任务环境变量

   解决办法：打开 `~/.zshrc` 文件，在文件的末尾，添加如下内容即可：

   ```
   source ~/.bash_profile
   ```

#### MySql 的语法规则

##### 结束符号

SQL 指令需要语句结束符号，默认是英文分号 `;`

另外两个结束符号：

- `/g` 与英文分号等效
- `/G` 将查询到的结构选择 90 度变成纵向

##### 反引号

SQL 语句中如果用到了关键字或者保留字，需要使用反引号 `` ` 来包裹，让系统忽略

#### MySQL 数据库的操作分类

根据数据库的对象层级，可以将 SQL 的基础操作分为四类：

- 数据库（DB）操作
- 数据表（Table）操作
- 数据字段（Field）操作
- 数据操作

在 Mac 终端执行 sql 命令时，命令的末尾必须加上`;`

##### 数据库（DB）的基本操作

###### 创建数据库

```
create database 数据库名称 [数据库选项];
```

数据库名称的命名规范：

- 有数字、字母和下划线组成
- 不区分大小写
- 不能以数字开头
- 建议使用下划线法创建复杂的数据库名字。比如 `db_qianguyihao`

###### 查看数据库

```
show databases;
```

查看指定数据库的具体创建指令（由于系统会加工，所以看到的结果不一定是真实的创建指令）:

```
show create database 数据库名称;
```

###### 使用指定的数据库

即进入指定的数据库。假如当前服务器连接了很多数据库，这时需要进入其中的一个数据库，操作里面的数据表

```
use 数据库名称;
```

###### 修改数据库的参数

```
alter database 数据库名称 [数据库选项];
```

###### 删除数据库

```
drop database 数据库名称;
```

##### 数据表（Table）的基本操作

需要先进入数据库，再进行数据表的操作

###### 创建数据表

```
create table [数据库名].[表名] (
	字段名1 字段类型,
	...
) [表选项];
```

- 字段类型

  - `NOT NULL`   不能为空

  - `AUTO_INCREMENT`   主键自动增长

    一个表中，只能有一个字段使用该约束，并且该字段的数据类型必须为整数类型

  - `PRIMARY KEY`   主键

    用于唯一标识表中的每一条数据。不能重复，不能为空

  `AUTO_INCREMENT` 的字段必须是主键，但主键不一定是 `AUTO_INCREMENT` ，只要是唯一的就可以，一个表只能有一个主键，但是主键可以是1个或者多个字段组成

- 存储引擎

  存储引擎是指数据存储和管理的方式，MySQL 中提供了多种存储引擎，一般使用默认的存储引擎 InnoDB

  - InnoDB ：默认的存储引擎。支持事务处理和外键；数据统一管理
  - MyIsam ：不支持事务和外键；数据、表结构、索引独立管理；MySQL5.6 以后不再维护

###### 复制数据表

将创建一个已有表一样的数据表。只会复制表1中的字段，不会复制数据

```
create table 表名1 like [数据库名称].表名2;
```

###### 显示数据表的名称

显示当前数据库下，所有的数据表：

```
show tables;
```

显示指定数据库的所有数据表：

```
show tables from 数据库名称;
```

显示数据表的创建指令：

```
show create table 表名;
```

###### 查询数据表的名称

查询出表名符合条件的数据表

```
show tables like '条件';
```

根据数据表的**表名称**查找数据表时，需要用到关键词 `like` ，而且还要涉及到两个符号：

- `%`   表示匹配任意**多个字符**。
- `_`   表示匹配任意**一个字符**（固定位置）

###### 查看数据表的结构

查看表中定义了哪些字段，以及这些字段是如何定义的

```
desc 数据表名称;

describe 数据表名称;

show columns from 数据表名称;
```

###### 修改数据表的表名称

```
rename table [数据库名称].原表名 to [数据库名称].新表名;
```

###### 修改数据表的选项（属性）

```
alter table [数据库名称].表名 表选项;
```

###### 删除数据表

```
drop table 数据表名称;
```

##### 字段（Field）的基本操作

###### 新增字段

```
alter table 表名 add [column] 字段名 字段类型 [字段属性] [字段位置];
```

字段位置：

- `first`   放到最前面
- `after 字段名`   放到某个字段的后面

###### 修改字段名

```
alter table 表名 change 原字段名 新字段名 字段类型 [字段属性] [字段位置];
```

虽然 `change` 关键字也可以修改现有字段的字段属性、字段位置，但我们一般是通过 `modify` 关键字来做

###### 修改字段类型、字段属性、字段位置

```
alter table 表名 modify 现有字段的字段名 现有字段的字段类型 [新的字段属性] [新的字段位置];
```

###### 修改字段的默认值

若本身存在默认值，则需要先删除：

```
alter table 表名 alter column 字段名 drop default;
```

若本身没有默认值，则可以直接设定：

```
alter table 表名 alter column 字段名 set default 默认值;
```

###### 删除字段

```
alter table 表名 drop 字段名;
```

##### 数据的基本操作

###### 新增数据

```
insert into 表名 values(值1, 值2, ...);
```

- 值的顺序必须与所有字段的顺序一致
- 值的数据类型也必须与字段定义的数据类型一致

###### 部分字段插入数据

```
insert into 表名(字段1, 字段2, ...) values(值1, 值2, ...);
```

字段的顺序可以随意，但值的顺序必须要与前面的字段顺序一一对应，数据类型也要一致

###### 查询数据

```
select 需要显示的字段 from [数据库名称].表名 [where 筛选条件] [排序方式];
```

显示所有字段：`*`

###### 修改数据

```
update 表名 set(字段1 = 新增1, 字段2 = 新值2, ...) [where 筛选条件];
```

###### 删除数据

注意：删除数据的操作**不可逆** 。执行删除操作后，匹配到的整体记录，都会删除

```
delete from 表名 [where 筛选条件];
```

###### where 筛选条件

- 比较运算符
  - `=`   等于
  - `>`   大于
  - `>=`   大于等于
  - `<`   小于
  - `<=`   小于等于
  - `!=`  不等于
- 逻辑运算符
  - `and`
  - `or`
  - `not`
- 范围查询
  - `in [值1, 值2, ...]`   表示在一个非连续的范围内
  - `between ... and ...`   表示在一个连续的范围内
- 模糊查询
  - `like`
    - `%`   表示任意多个任意字符
    - `_`   表示一个任意字符

###### null 的判断

- `is null`   判断为空
- `is not null`   判断为非空

`is null` 和**空字符串** `""` 是有区别的。空字符串并非 null，只不过是里面的值为空而已；空字符串也是会占有内存空间的

###### join 联表查询

参考：https://blog.csdn.net/qmhball/article/details/8000003

- 表1 与 表2 匹配到的行会出现在结果中

  ```
  表名1 inner join 表名2
  ```

- 表1 与 表2 匹配到的行会出现在结果中。表1 中独有的数据，对应 表2 中用 null 填充

  ```
  表名1 left join 表名2
  ```

- 表1 与 表2 匹配到的行会出现在结果中。表2 中独有的数据，对应 表1 中用 null 填充

  ```
  表名1 right join 表名2
  ```

#### MySQL 中字段的数据类型

- 整数
- 小数
- 字符串
- 时间日期

##### 整数

- tinyint ：迷你整型，使用**1个字节**存储整数，最多存储 256 个整数（-128～127）
- smallint ：短整型，使用**2个字节**存储整数
- mediumint ：中整型，使用**3个字节**存储整数
- int ：标准整型，使用**4个字节**存储整数
- bigint ：大整型，使用**8个字节**存储整数

整型在 MySQL 中默认是有符号的，即有正负。无符号需要使用 `unsigned` 修饰，代表正整数

###### 整数类型的取值范围

参考：https://blog.csdn.net/slyjit/article/details/54290486

| 类型              | 字节 | 最小值               | 最大值               |
| ----------------- | ---- | -------------------- | -------------------- |
| TinyInt(有符号)   | 1    | -128                 | 127                  |
| TinyInt(无符号)   | 1    | 0                    | 255                  |
| SmallInt(有符号)  | 2    | -32768               | 32767                |
| SmallInt(无符号)  | 2    | 0                    | 65535                |
| MediumInt(有符号) | 3    | -8388608             | 8388607              |
| MediumInt(无符号) | 3    | 0                    | 16777215             |
| Int(有符号)       | 4    | -2147483648          | 2147483647           |
| Int(无符号)       | 4    | 0                    | 4294967295           |
| BigInt(有符号)    | 8    | -9223372036854775808 | 9223372036854775807  |
| BigInt(无符号)    | 8    | 0                    | 18446744073709551615 |

###### 整数类型的显示宽度和零填充

参考：https://juejin.im/post/6844903621289574414

- 显示宽度

  显示宽度，即定义为整数类型时，使用 `()` 括起来一个数字，表示在显示的时候，**看到的最少数字个数**

  如果数据的长度比设定的宽度小，则在前面补零；如果超过了显示宽度，则直接显示原始值

  - 显示宽度只适用于 MySQL 的整数类型
  - 显示宽度只是指明 MySQL 整数类型最少显示的数字个数（可以通过desc查看表字段显示）
  - **显示宽度只是在显示的时候改变数值的样式，不会对原本的值进行更改**
  - 显示宽度和数值类型的取值范围无关。例如 int(10)  他的取值范围依然是(-2147483648，2147483647)

- 零填充
  - 要想让显示宽度自动进行**零填充**，必须要配合 `ZEROFILL` 这个关键字一起使用。
  - **零填充只能针对正整数**，也就是说，`ZEROFILL` 要求整型为无符号型

##### 小数

- float ：单精度，使用**4个字节**存储，精度范围为 6~7 位有效数字
- double ：双精度，使用**8个字节**存储，精度范围为 14~15 位有效数字

浮点数超过精度范围会自动进行四舍五入

精度可以指定整数和小数部分

#### MySQL 设计的三范式

参考：https://www.jianshu.com/p/3e97c2a1687b

范式，即规范。MySQL 范式的作用：

- 让我们建的表更佳简洁和高效
- 让功能独立化，避免耦合

##### 第一范式（1NF）：原子性

表的每一列具有原子性，不可再分

##### 第二范式：唯一性

第二范式是建立在第一范式基础上的；外要求所有非主键字段必须完全依赖主键，而不是部分依赖

##### 第三范式

第三范式是建立在第二范式基础上的；且要求没有传递依赖

#### 事务语句

- `begin`   开启
- `commit`   提交
- `rollback`   回滚